import pandas as pd
from datetime import datetime

# Read the CSV files into DataFrames
master_df = pd.read_csv('master.csv')
delta1_df = pd.read_csv('delta1.csv')
delta_removed_df = pd.read_csv('delta_removed.csv')

# Set the initial flag value to "Not found"
master_df['flag'] = 'Not found'

# Update flag to "to be migrated" for records in delta1
master_df.loc[master_df['record_id'].isin(delta1_df['record_id']), 'flag'] = 'to be migrated'

# Update flag to "removed" for records in delta_removed
master_df.loc[master_df['record_id'].isin(delta_removed_df['record_id']), 'flag'] = 'removed'

# Add actual_mig_date for all removed records
delta_removed_df['actual_mig_date'] = pd.to_datetime(delta_removed_df['timestamp'], errors='coerce').dt.date
delta_removed_dates = dict(zip(delta_removed_df['record_id'], delta_removed_df['actual_mig_date']))
master_df['actual_mig_date'] = master_df['record_id'].map(delta_removed_dates)
master_df['actual_mig_date'] = master_df['actual_mig_date'].fillna(datetime.now().date())

# Save the updated master_df if needed
master_df.to_csv('updated_master.csv', index=False)
