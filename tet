import requests

def get_hostname_and_connect(url):
    try:
        response = requests.get(url)
        response.raise_for_status()
        connecting_hostname = response.headers.get('Connecting-Hostname')
        return connecting_hostname
    except requests.exceptions.RequestException as e:
        print(f"Error accessing URL: {e}")
        return None

def authenticate(username, password, connecting_hostname):
    auth_url = f'https://{connecting_hostname}/api/authenticate'
    data = {'username': username, 'password': password}

    try:
        response = requests.post(auth_url, json=data)
        response.raise_for_status()
        token = response.json().get('token')
        return token
    except requests.exceptions.RequestException as e:
        print(f"Authentication failed: {e}")
        return None

# Example usage:
if __name__ == "__main__":
    initial_url = 'https://example.com/initial-url'
    username = 'your_username'
    password = 'your_password'

    connecting_hostname = get_hostname_and_connect(initial_url)

    if connecting_hostname:
        token = authenticate(username, password, connecting_hostname)
        if token:
            print(f"Successfully authenticated. Token: {token}")
        else:
            print("Authentication failed.")
    else:
        print("Failed to retrieve connecting hostname.")
