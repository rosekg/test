import imaplib
import email
import os

# IMAP authentication details
#username = 'YOUR_EMAIL_ADDRESS'
#password = 'YOUR_EMAIL_PASSWORD'
imap_server = 'outlook.office365.com'

username = 'prabhutk07@outlook.com'
password = 'CAhcet@2011P'
#subject = 'ABC inventory'


# Connect to the IMAP server
mail = imaplib.IMAP4_SSL(imap_server)
mail.login(username, password)
print("Login successful")
# Select the inbox
mail.select('inbox')

# Search for emails with the subject "ABC inventory"
result, data = mail.search(None, '(SUBJECT "ABC inventory")')

print(result)
print(data)

for num in data[0].split():
    result, data = mail.fetch(num, '(RFC822)')
    raw_email = data[0][1]
    msg = email.message_from_bytes(raw_email)
    print(result)
    #print(data)
    #print(raw_email)
    #print(msg)
    print(msg['Subject'])

    # Check if the subject is "ABC inventory"
    if 'ABC inventory' in msg['Subject'] :
        print(msg['Subject'])
        for part in msg.walk():
            if part.get_content_maintype() == 'multipart':
                continue
            if part.get('Content-Disposition') is None:
                continue
            filename = part.get_filename()
            if filename:
                att_path = os.path.join(os.getcwd(), filename)
                with open(att_path, 'wb') as f:
                    f.write(part.get_payload(decode=True))

# Close the connection
mail.close()
mail.logout()
