from kafka import KafkaConsumer, TopicPartition

# Kafka broker
bootstrap_servers = 'localhost:9092'
# Consumer group id
group_id = 'my_consumer_group'
# Kafka topic
topic = 'my_topic'

# Create a KafkaConsumer
consumer = KafkaConsumer(
    group_id=group_id,
    bootstrap_servers=bootstrap_servers,
    auto_offset_reset='earliest',  # Start from the earliest message
    enable_auto_commit=False  # Disable auto commit
)

# Assign the topic and partitions to the consumer
consumer.assign([TopicPartition(topic, partition) for partition in consumer.partitions_for_topic(topic)])

# Get the current offsets for each partition
current_offsets = {tp.partition: tp.offset for tp in consumer.assignment()}
# Seek to the beginning of each partition
for tp in consumer.assignment():
    consumer.seek_to_beginning(tp)

# Get the beginning offsets for each partition
beginning_offsets = {tp.partition: consumer.position(tp) for tp in consumer.assignment()}

# Calculate the lag for each partition
lags = {partition: beginning_offsets[partition] - current_offsets.get(partition, 0) for partition in consumer.partitions_for_topic(topic)}

# Print the lags
for partition, lag in lags.items():
    print(f"Partition {partition}: Lag = {lag}")

# Close the consumer
consumer.close()
