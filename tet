#!/bin/bash

# Input and output file paths
input_file="tables_list.txt"  # File containing list of table names (one per line)
output_file="first_partitions.txt"  # Output file to write the results

# Ensure output file is empty
> "$output_file"

# Loop through each table in the input file
while IFS= read -r table_name; do
  # Skip empty lines
  [ -z "$table_name" ] && continue

  # Fetch the first partition for the current table
  first_partition=$(hive -e "SHOW PARTITIONS $table_name;" | head -n 1)

  # Check if the partition was successfully retrieved
  if [ -n "$first_partition" ]; then
    echo "Table: $table_name, First Partition: $first_partition" >> "$output_file"
  else
    echo "Table: $table_name, First Partition: NONE" >> "$output_file"
  fi
done < "$input_file"

echo "Processing completed. Results saved in $output_file"
