import java.io.FileWriter;
import java.io.IOException;
import java.util.ArrayList;
import java.util.List;

public class FileWriterModule {

    private final FileWriter fileWriter;
    private final List<String> dataBuffer;
    private final boolean writeCsv;

    public FileWriterModule(String fileName, boolean writeCsv) throws IOException {
        this.writeCsv = writeCsv;
        String extension = writeCsv ? ".csv" : ".json";
        this.fileWriter = new FileWriter(fileName + extension, true);
        this.dataBuffer = new ArrayList<>();
    }

    public void addData(String jsonMessage) {
        if (writeCsv) {
            dataBuffer.add(jsonMessage.replace(",", ";")); // Replace commas for CSV
        } else {
            dataBuffer.add(jsonMessage);
        }
    }

    public void flushData() throws IOException {
        for (String data : dataBuffer) {
            fileWriter.append(data).append("\n");
        }
        fileWriter.flush();
        dataBuffer.clear();
    }

    public void close() {
        try {
            fileWriter.close();
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}
