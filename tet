import pandas as pd

# Sample Input DataFrame
data = {'cola': ['ABC', 'DEF', 'ABC', 'GHI', 'DEF', 'GHI', 'JKL'],
        'colb': ['AAA', 'BBB', 'EEE', 'EEE', 'BBB', 'EEE', 'DDD']}
df = pd.DataFrame(data)

# Initialize the new columns
df['is_cola_shared'] = 'no'
df['shared_colb_values'] = ''
df['shared_colb_values_count'] = 0

# Check if cola value is shared and update the columns accordingly
cola_counts = df['cola'].value_counts()
shared_cola_values = cola_counts[cola_counts > 1].index

for cola_value in shared_cola_values:
    mask = df['cola'] == cola_value
    df.loc[mask, 'is_cola_shared'] = 'yes'

# Aggregate unique 'colb' values for shared 'cola' values across the entire DataFrame
for cola_value in shared_cola_values:
    shared_colb_values = df.loc[df['cola'] == cola_value, 'colb'].unique().tolist()
    df.loc[df['cola'] == cola_value, 'shared_colb_values'] = shared_colb_values
    df.loc[df['cola'] == cola_value, 'shared_colb_values_count'] = len(shared_colb_values)

# Display the updated DataFrame
print(df)
