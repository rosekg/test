import requests
import csv
import json

# Replace these placeholders with actual values
login_url = 'https://your_web_portal.com/login'
explore_data_url = 'https://your_web_portal.com/explore_data'
export_csv_file = 'exported_data.csv'
username = 'your_username'
password = 'your_password'

# Step 1: Login to the web portal
login_data = {
    'username': username,
    'password': password,
    'submit': 'login'
}

session = requests.Session()
login_response = session.post(login_url, data=login_data)

# Check if the login was successful
if login_response.status_code == 200:
    print("Login successful")
else:
    print("Login failed")
    exit()

# Step 2: Access the explore_data endpoint
explore_data_response = session.get(explore_data_url)

# Check if accessing the explore_data endpoint was successful
if explore_data_response.status_code == 200:
    print("Access to explore_data successful")
else:
    print("Access to explore_data failed")
    exit()

# Step 3: Parse the JSON response and extract the data
data = explore_data_response.json()

# Example config file (replace with actual config file)
config_file = {
    'columns': ['column1', 'column2', 'column3']
}

# Step 4: Select columns based on config file
selected_data = [{col: entry[col] for col in config_file['columns']} for entry in data]

# Step 5: Export selected data to CSV file
with open(export_csv_file, 'w', newline='') as csv_file:
    csv_writer = csv.DictWriter(csv_file, fieldnames=config_file['columns'])
    csv_writer.writeheader()
    csv_writer.writerows(selected_data)

print(f"Data exported to {export_csv_file}")
