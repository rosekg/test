filter {
  ruby {
    code => '
      duration = event.get("duration_mins").to_f
      avg = event.get("avg_duration_mins").to_f
      category = event.get("job_category").to_s

      if duration > avg
        diff = duration - avg
        if diff <= 60
          event.set("flag", 0)
        elsif diff > 60 || category.downcase == "cata"
          event.set("flag", 1)
        end
      else
        event.set("flag", -1)
      end
    '
  }
}
