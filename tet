input {
  kafka {
    bootstrap_servers => "kafka-broker1:9092,kafka-broker2:9092"  # Replace with your Kafka broker addresses
    topics => ["your-kafka-topic"]
    group_id => "logstash-consumer-group"
  }
}

filter {
  ruby {
    code => '
      require "roo"
      require "json"
      header = ["header1", "header2", "header3"]  # Replace with your XLSX header column names
      excel = Roo::Excelx.new(StringIO.new(event.get("message")))
      sheet = excel.sheet(0)  # Assuming the data is in the first sheet

      if sheet.row(1) != header
        event.cancel
      else
        data = sheet.parse(header)
        event.set("parsed_data", data.to_json)
      end
    '
  }
}

output {
  elasticsearch {
    hosts => ["http://localhost:9200"]  # Replace with your Elasticsearch host
    index => "your-elasticsearch-index"
  }
}
