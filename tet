#!/bin/bash

# Define the maximum duration for a job to be considered long running
MAX_DURATION=72000 # 72000 seconds = 20 hours

# Get the current timestamp in seconds
current_time=$(date +%s)

# Get the list of running applications in the Yarn cluster
yarn application -list | awk 'NR > 2 {print $1}' | while read app_id; do
  # Get the start time of the application in seconds
  start_time=$(yarn application -status $app_id | grep "Start-Time" | awk '{print $NF}')
  start_time=$(date -d "$start_time" +%s)

  # Calculate the duration of the application
  duration=$((current_time - start_time))

  # Check if the duration of the application is greater than the maximum duration
  if [[ $duration -gt $MAX_DURATION ]]; then
    # Print the application ID and duration if it is a long running job
    echo "Application ID: $app_id, Duration: $duration seconds"
  fi
done
