from elasticsearch import Elasticsearch, helpers

# Source and destination Elasticsearch hosts
source_host = 'http://source_host:9200'
dest_host = 'http://dest_host:9200'

# Initialize Elasticsearch clients for source and destination hosts
source_es = Elasticsearch(source_host)
dest_es = Elasticsearch(dest_host)

# Source index and query
source_index = 'source_index'
query = {"query": {"match_all": {}}}

# Use the scan API to efficiently retrieve all documents from the source index
scan_result = helpers.scan(
    client=source_es,
    index=source_index,
    query=query
)

# Bulk index the retrieved documents into the destination index
dest_index = 'dest_index'
actions = [
    {
        "_index": dest_index,
        "_id": doc["_id"],
        "_source": doc["_source"]
    }
    for doc in scan_result
]

# Perform the bulk indexing operation
helpers.bulk(dest_es, actions)

print(f"Data copied from '{source_index}' on '{source_host}' to '{dest_index}' on '{dest_host}'")
